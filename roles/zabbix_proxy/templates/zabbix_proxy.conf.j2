# ==============================================================================
# Template de Configuração do Zabbix Proxy
# Arquivo: roles/zabbix_proxy/templates/zabbix_proxy.conf.j2
# Descrição: Este template gera o arquivo de configuração do Zabbix Proxy,
#            utilizando variáveis globais para garantir consistência.
# ==============================================================================

# --- Parâmetros Gerais ---
ProxyMode={{ zabbix_proxy_mode }}
Hostname={{ zabbix_proxy_hostname }}
Server={{ zabbix_server_ip }}
ServerPort=10051
SourceIP={{ pop_network_ipv4_address | split('/') | first }} 
ListenPort={{ zabbix_proxy_listenport }}
ListenIP={{ zabbix_proxy_listenip }}
PidFile={{ zabbix_proxy_pidfile }}
SocketDir={{ zabbix_proxy_socket_dir }}
LogFile={{ zabbix_proxy_logfile }}
LogFileSize={{ zabbix_proxy_logfile_size }}
DebugLevel={{ zabbix_proxy_debug_level }}

# --- Parâmetros de Processos ---
StartPollers={{ zabbix_proxy_startpollers }}
StartPreprocessors={{ zabbix_proxy_startpreprocessors }}
StartPollersUnreachable={{ zabbix_proxy_startpollersunreachable }}
StartTrappers={{ zabbix_proxy_starttrappers }}
StartPingers={{ zabbix_proxy_startpingers }}
StartDiscoverers={{ zabbix_proxy_startdiscoverers }}
StartHTTPPollers={{ zabbix_proxy_starthttpollers }}
StartSNMPPollers={{ zabbix_proxy_startsnmppollers }}
StartAgentPollers={{ zabbix_proxy_startagentpollers }}
StartDBSyncers={{ zabbix_proxy_startdbsyncers }}
StartIPMIPollers={{ zabbix_proxy_startipmipollers }}
StartVMwareCollectors={{ zabbix_proxy_startvmwarecollectors }}

# --- Configuração de Banco de Dados e Cache ---
DBName={{ zabbix_proxy_dbname }}
ProxyBufferMode={{ zabbix_proxy_buffermode }}
ProxyMemoryBufferSize={{ zabbix_proxy_memory_buffer_size }}
CacheSize={{ zabbix_proxy_cachesize }}
HistoryCacheSize={{ zabbix_proxy_historycachesize }}
HistoryIndexCacheSize={{ zabbix_proxy_historyindexcachesize }}
ProxyOfflineBuffer={{ zabbix_proxy_offline_buffer }}
ProxyLocalBuffer={{ zabbix_proxy_proxybuffer }}
AllowUnsupportedDBVersions={{ zabbix_proxy_allow_unsupported_db }}

# --- Timers e Timeout ---
HeartbeatFrequency={{ zabbix_proxy_heartbeat_frequency }}
ConfigFrequency={{ zabbix_proxy_config_frequency }}
DataSenderFrequency={{ zabbix_proxy_datasender_frequency }}
HousekeepingFrequency={{ zabbix_proxy_housekeeping_frequency }}
Timeout={{ zabbix_proxy_timeout }}
TrapperTimeout={{ zabbix_proxy_trappertimeout }}
UnreachablePeriod={{ zabbix_proxy_unreachable_period }}
UnavailableDelay={{ zabbix_proxy_unavailable_delay }}
UnreachableDelay={{ zabbix_proxy_unreachable_delay }}

# --- TLS ---
TLSConnect={{ zabbix_proxy_tls_connect }}
TLSAccept={{ zabbix_proxy_tls_accept }}
TLSPSKIdentity={{ zabbix_proxy_psk_identity }}
TLSPSKFile={{ zabbix_proxy_psk_file }}

# --- Caminhos de Binários e Arquivos ---
ExternalScripts=/usr/lib/zabbix/externalscripts
FpingLocation={{ zabbix_proxy_fping_location }}
Fping6Location={{ zabbix_proxy_fping6_location }}
SSHKeyLocation={{ zabbix_proxy_ssh_key_location }}